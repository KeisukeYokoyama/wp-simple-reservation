# Googleカレンダー連携セットアップ手順

WP Simple ReservationプラグインのGoogleカレンダー連携機能のセットアップ手順です。

## 前提条件

- WordPress 5.0以上
- PHP 7.4以上
- Google Cloud Platformアカウント
- OpenSSL拡張機能（PHPに標準で含まれています）

## セットアップ手順

### 1. Google Cloud Consoleでプロジェクトを作成

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成または既存のプロジェクトを選択
3. プロジェクト名を記録（後で使用）

### 2. Calendar APIを有効化

1. Google Cloud Consoleの左側メニューから「APIとサービス」→「ライブラリ」を選択
2. 検索ボックスで「Google Calendar API」を検索
3. Google Calendar APIを選択して「有効にする」をクリック

### 3. サービスアカウントを作成

1. Google Cloud Consoleの左側メニューから「APIとサービス」→「認証情報」を選択
2. 「認証情報を作成」→「サービスアカウント」をクリック
3. サービスアカウント名を入力（例：wp-simple-reservation）
4. サービスアカウントIDを入力（例：wp-simple-reservation@project-id.iam.gserviceaccount.com）
5. 「キーを作成」→「JSON」を選択してキーファイルをダウンロード

### 4. Googleカレンダーで権限を付与

1. [Googleカレンダー](https://calendar.google.com/)にアクセス
2. 予約を反映したいカレンダーの設定を開く
3. 「特定のユーザーと共有」でサービスアカウントのメールアドレスを追加
4. 権限を「予定の変更」に設定

### 5. プラグインの設定

1. WordPress管理画面で「予約管理」→「Googleカレンダー連携」を開く
2. 「Googleカレンダー連携を有効にする」にチェック
3. ダウンロードしたJSONファイルの内容を「サービスアカウントJSON」に貼り付け
4. カレンダーIDを入力（例：example@gmail.com）
5. デフォルト予約時間を設定（例：1時間）
6. 「設定を保存」をクリック
7. 「接続テスト」をクリックして接続を確認

## カレンダーIDの確認方法

### プライマリカレンダーの場合
- Gmailアドレス（例：example@gmail.com）

### 共有カレンダーの場合
1. Googleカレンダーでカレンダー設定を開く
2. 「カレンダーの統合」セクションで「カレンダーID」を確認
3. 例：example.com_abc123@group.calendar.google.com

## 動作確認

1. フロントエンドで予約フォームから予約を作成
2. Googleカレンダーに予約イベントが自動的に作成されることを確認
3. イベントには予約者名、メール、電話番号、メッセージが含まれる

## トラブルシューティング

### 接続テストでエラーが発生する場合

1. **サービスアカウントJSONが正しくない**
   - JSONファイルの内容が正しくコピーされているか確認
   - JSONの構文エラーがないか確認

2. **カレンダーIDが間違っている**
   - カレンダーIDが正しく入力されているか確認
   - カレンダーが存在し、アクセス権限があるか確認

3. **権限が不足している**
   - サービスアカウントにカレンダーの編集権限が付与されているか確認
   - Calendar APIが有効になっているか確認

### 予約がGoogleカレンダーに反映されない場合

1. **プラグインのログを確認**
   - WordPressのデバッグログでエラーメッセージを確認
   - エラーログの場所：`wp-content/debug.log`

2. **設定を再確認**
   - Googleカレンダー連携が有効になっているか確認
   - 設定が正しく保存されているか確認

## 注意事項

- この機能は新規予約の作成時のみ動作します（編集・削除時の同期はありません）
- 予約時間は設定で指定したデフォルト時間でGoogleカレンダーに反映されます
- サービスアカウントのJSONキーは機密情報です。適切に管理してください
- Google APIの利用制限に注意してください（1日あたりのリクエスト数制限など）
- この実装は軽量版で、外部ライブラリに依存せずに動作します
- WordPressの標準HTTP関数（wp_remote_post, wp_remote_get）を使用しています

## サポート

問題が発生した場合は、以下の情報を確認してください：

1. WordPressのバージョン
2. PHPのバージョン
3. プラグインのバージョン
4. エラーログの内容
5. Google Cloud Consoleの設定状況
